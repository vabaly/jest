# Jest 学习笔记

## 此项目运行问题

- 此项目在执行 `yarn` 的时候，会在 `Building TypeScript definition files` 阶段停留好长一段时间，**千万不要在这里退出**，这个阶段完成后执行 `yarn jest` 才不会报错


## Jest 本身的学习

## 异步的匹配

和平时写异步没什么区别，在异步回调里面、 `.then` 函数里面、`await` 后面等地方使用 `expect` 来比较。可能需要记住的是 `.expect(<Promise>).resolve/reject.<Matcher>` 的方法。

问题：

1. `expect.assertions` 到底有什么用？

## 时间模拟

- 首先，需要声明自己要使用模拟的时间，而非实际的时间，在文件最上面写 `jest.useFakeTimers()`
- 其次，每个测试用例都需要重置（重新初始化）定时器，使用 `jest.spyOn` 来往 `global` 全局对象里面加入定时器
- 然后，有两种方法可以模拟定时器，一种是让定时器回调函数立即从任务队列中被拿来执行（忽略时间），还有一种是将时间快进到执行回调函数的时候（调整时间）：
  - 第一种使用 `jest.runAllTimers()` 或者 `jest.runOnlyPendingTimers()`，这两者的区别是，前者会在执行完回调函数后再检查队列中有没有新的回调函数，有的话再执行掉，后者仅执行当前队列中存在的回调函数，后面新加的不会再执行，也就是不会再去检查队列了。
  - 第二种是用 `jest.advanceTimersByTime(<times>)` 快进时间
- 最后，就是检查定时器函数被调用次数，或者定时器函数的输入参数是否符合预期，或者某一次的定时器函数的输入参数是否符合预期等等

Jest 的时间模拟并没有去掉 JavaScript 的事件循环的概念，当执行假的定时器时，也会回掉函数放入到队列中，然后通过一些方法来去掉时间概念或快进时间（没有去掉时间概念），从而让回调函数立即执行。

